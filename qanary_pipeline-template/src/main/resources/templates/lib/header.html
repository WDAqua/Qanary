    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans" />
                <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
				<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
                <script src="//code.jquery.com/jquery-1.10.2.js"></script>
                <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <style>
    body { 
        font-family:Open Sans; 
        font-size:12pt; 
        background-color: #f1f1f1; 
        font-color: #333; 
        margin: 0; 
        padding: 0;
    }
    h1 { 
	    /* TODO: Github is used here, should be replaced by SVG */
        background-size: 100px auto;
        background: url(https://raw.githubusercontent.com/WDAqua/Qanary/master/doc/logo-qanary_s.png) no-repeat left/120px;
        background-position-x: 1ex;
        padding-top: 1ex;
	    padding-bottom: 1.1ex;
	    padding-left: 16ex;
	    font-size: 14pt; 
	    font-weight: 600; 
    }
    h2 {
    	font-size: 12pt;
	    font-weight: 600; 
	    margin-top: 2ex;
    	margin-bottom: 1ex;
    }
    .applicationheader h2 {
	    width: 75%;
	    float: left;
	    margin-block: 0;
	    margin-inline-start: 0;
	    margin-inline-end: 0;    
    }
    h3 {
    	font-size: 11pt;
	    font-weight: 600; 
	    margin-top: 2ex;
    	margin-bottom: 1ex;
    }
    .applicationheader { 
        background-color: #34302D; 
        color:#f1f1f1; 
        padding:0.25ex; 
        height: 2.75ex;
    }
    header { background-color: #34302D; }
    form, #SPARQLqueryeditorblock { 
    	margin-left: 1ex; 
    }
    input[type=text] { 
                width:50%;
                display:block; 
                margin-bottom:2ex; 
                max-width:500px;
                font-size: 13pt; 
                padding:5px;
                border: 1px solid #999;
        }
    input[type=text].isempty {
        background-color:#FFC; 
    }
    #sortable {  
        list-style-type: none; 
        margin: 0; 
        padding: 0; 
        border: 1px solid #34302D;
    } 
    #sortable.missingcomponentselection {
    	border-color: #FFC;
    }  
    
    div.selection {
        margin: 0; 
        min-width: 800px;
        width: 50%; 
        padding:0;
        border: 2px solid #34302D;
    }
    #sortable li {
        margin:0.25ex; 
        padding: 0.25ex; 
        border: 1px solid #34302D; 
        font-size:13pt; 
        background-color: #f1f1f1; 
        color: #34302D; 
        cursor:ns-resize;
    }
    #sortable li.selected {
        background-color:#FFF;
        color:#000;
    }
    #sortable li:hover {
        background-color:#FFFFF0;
    }
    #sortable li.selected:hover {
        background-color:#FFFFF9;
    }
    
    .annotationCount{
		font-size:80%;
    }
    
    .annotationCount[data-count]{
    	background-color:#CFC;
    	color:#000;
    }

    .annotationCount[data-count="0"]{
    	background-color:transparent;
    	color:#999;
    }
    
    button { 
        font: normal normal normal 14px/1 FontAwesome; 
        margin-top: 1ex; 
        padding:1ex 1ex; 
        transition: background-position .1s linear;
        color: #FFF;
        border-radius: 4px;
        border: 1px solid #999; 
        background-color: #00bc7c; 
        cursor: pointer;
    } 
    
    #showadditionaltripleinput {
        padding: 0.5ex;
        margin: 0;
        background-color: #999;
    }
    
    button:hover { 
        border: 1px solid #333; 
        filter: opacity(0.9);
    }
    button:disabled, button[disabled] {
  		background-color: #005173;
  		cursor:not-allowed;
	}
    button:disabled.inprogress, button[disabled].inprogress {
		cursor:progress;
	}
	button.helpers { 
        font: normal normal normal 12px/1 FontAwesome; 
        color: #000;
        border: 1px solid #999; 
        background-color: #CCC; 
		margin: 0.1ex;
		padding: 0.5ex;	
    }   
    #componentfilterbox {
	    width: 25%;
	    text-align: right;
	    float: right;
	    padding: 0;    	
    }
    #componentfilterinput {
	    width: 100%;
	    max-width: 20ex;
	    margin: 0;
	    padding: 0ex;
	    padding-left:0.5ex;
    }
    footer {
    	border-top: 1px solid #999;
    	margin-top: 7ex;
    	padding-left: 1ex;
    	padding-top: 4ex;
    	font-size:80%;
    }
    footer a {
    	color:#00F;
    }
    footer a:visited {
    	color:#00F;
    }
    footer a:hover {
    	color:#66F;
    }
    footer h3 {
    	font-size:90%;
    }
    #results, #SPARQLqueryeditorblock {
    	border-top: 1px dashed #00bc7c;
    	margin: 1ex;
    	margin-top: 2ex;
    }
    #results table {
    	font-size: 90%;
    	border: 1px solid #333;
    	margin-top: 1ex;
    }
    #results th {
    	font-weight: bold;
    	color: #FFFFFF;
    }
    #results tr:nth-child(even) {
    	background-color: #f2f2f2;
    }
    #results tr:nth-child(odd) {
    	background-color: #FFFFFF;
    }
    #results tr.header {
    	background-color: #000000;
    }
    .yasqe .yasqe_buttons .yasqe_queryButton .queryIcon svg {
    	fill: #00bc7c
    }
    #errormessage {
        margin-top: 1ex;
    	display:none;
        background-color: #FF0;
    	border: 2px solid #F00;
    	padding: 1ex;
    	padding-top:
    }
    .coreMessage {
    	font-family: monospace;
    }
    </style>
    <script th:inline="javascript">
       	// TODO: move minimumNumberOfSelectedComponents to config
       	minimumNumberOfSelectedComponents = 1;
       	
        $(function() {
        		// make the li elements sortable (by drag and drop)
                $( "#sortable" ).sortable();
                // disable text selection on draggable elements 
                $( "#sortable" ).disableSelection();
                // change style of selected elements
                $( "#sortable li input").click( function(){
                        if( $(this).prop("checked") == true ){
                                $(this).addClass("selected");
                                $(this).parents("li").addClass("selected");     
                        } else {
                                $(this).removeClass("selected");
                                $(this).parents("li").removeClass("selected");
                        }                       
                    	checkInputAndOptionallyDisableSubmitButton("#submit");
                });
                // check the value of the question input -> might disable the submit button
                $("#question").focusout( function(){
                	checkInputAndOptionallyDisableSubmitButton("#submit");
                });
                // check the value of the question input, while typing -> might disable the submit button
                $("#question").keypress( function(){
                	checkInputAndOptionallyDisableSubmitButton("#submit");
                });
                // check the selections within the component list
                $("#submit").mouseover(function(){
                	checkInputAndOptionallyDisableSubmitButton("#submit");
                });

                $("#results").hide(); // hide results table

                // add AJAX action to form
                $("#startForm").submit(function(event){
                	event.preventDefault(); // prevent default action 
                	$("#submit").attr("disabled", true); // disable button
                	$("#submit").addClass("inprogress"); // change cursor
                	$("#results").slideUp(500); // hide last results with animation
                	$("#errormessage").slideUp(500); // hide last ERROR message with animation
                	$("#errormessage").html();
                    removeAnnotationCount(); // clear old annotation count values
                    message = "";
                    $.ajax({
                		url : $(this).attr("action"), // get action url
                		type: $(this).attr("method"), //get method
                		data: $(this).serialize() // encode form elements 
                	}).done(function(response){ 
                		console.log(response);
                    	$("#submit").attr("disabled", false); // reactivate button
                    	$("#submit").removeClass("inprogress");
                		$("#endpoint").html(response.endpoint);
                		$("#questionuri").html(response.question);
                		$("#inGraph").html(response.inGraph);
                		$("#protocol_link").html($("<a></a>").text("process details").prop("href","/questionanswering/" + response.inGraph).prop("target","_blank"));
                		$("#all_annotation_link").html($("<a></a>").text("all annotations").prop("href","/components/" + response.inGraph + "/*").prop("target","_blank"));
                		$("#outGraph").html(response.outGraph);
                    	$("#results").slideDown("fast"); // show results with animation
                    	$("#results").show();
                        getNumberOfAnnotations(response.outGraph); // get new number of annotations
                	}).error(function (jqXHR, textStatus) {
                		console.error("textStatus: ", textStatus);
                		console.error("jqXHR: ", jqXHR);
                        $("#submit").attr("disabled", false); // reactivate button
                        $("#submit").removeClass("inprogress");
                        jsonMessage = jqXHR.responseJSON["message"];
                        textMessage = jqXHR.responseText;
                        if (jsonMessage) {
                        	console.log("jsonMessage:", jsonMessage);                        	
                        	coreMessage = jsonMessage.substr(0, jsonMessage.indexOf("|", jsonMessage.indexOf(":")) + 1)
                        } else if (textMessage){
                        	console.log("textMessage:",textMessage);
                       		coreMessage = textMessage;
                        } else if (textStatus){
                        	console.log("textStatus:",textStatus);
                       		coreMessage = textStatus;
                        } else {
                        	console.log("error message: none found");
                        	coreMessage = "";
                        }
                        message = "ERROR: The process failed.\nPlease check your implementation!\n<p class=\"coreMessage\">" + coreMessage + "</p>See your browser developer console for details."; 
	                	$("#errormessage").html(message);
                    	$("#errormessage").slideDown("fast"); // show results with animation
                    	$("#errormessage").show();
                        // alert(message);
                        console.error(message);
                	}).fail(function (jqXHR, textStatus) {
                		if(message == ""){ // only do this if it was not done in the error() block
	                		console.error("textStatus: ", textStatus);
	                		console.error("jqXHR: ", jqXHR);
	                        $("#submit").attr("disabled", false); // reactivate button
	                        $("#submit").removeClass("inprogress");
	                        jsonMessage = jqXHR.responseJSON["message"];
	                        textMessage = jqXHR.responseText;
	                        if (jsonMessage) {
	                        	console.log("jsonMessage:", jsonMessage);                        	
	                        	coreMessage = jsonMessage.substr(0, jsonMessage.indexOf("|", jsonMessage.indexOf(":")) + 1)
	                        } else if (textMessage){
	                        	console.log("textMessage:",textMessage);
	                       		coreMessage = textMessage;
	                        } else if (textStatus){
	                        	console.log("textStatus:",textStatus);
	                       		coreMessage = textStatus;
	                        } else {
	                        	console.log("error message: none found");
	                        	coreMessage = "";
	                        }
	                        message = "ERROR: The process failed.\nPlease check your implementation!\n<p class=\"coreMessage\">" + coreMessage + "</p>See your browser developer console for details."; 
		                	$("#errormessage").html(message);
	                    	$("#errormessage").slideDown("fast"); // show results with animation
	                    	$("#errormessage").show();
	                        // alert(message);
	                        console.error(message);
						}
                	});
                });
        });

        // remove any AnnotationCount components so that props can be updated correctly
        function removeAnnotationCount() {
            /*<![CDATA[*/
            let components = Object.keys([[${componentList}]])
            for (i = 0; i < components.length; i++) {
                let element = document.getElementById("annotationcount"+components[i]);
                if(element){
                    ReactDOM.unmountComponentAtNode(element);
                }
            }
            /*]]>*/
        }

        // mount individual AnnotationCount to every component checklist item
        function getNumberOfAnnotations(graph) {
            console.log(graph)
            /*<![CDATA[*/
            let components = Object.keys([[${componentList}]]);
            for (i = 0; i < components.length; i++) {
                console.log(graph)
                elementID = "annotationcount" + components[i];
                props = {
                    component: components[i],
                    graph: graph,
                    fetched: false,
                    annotationID: (elementID)
                }
                let annotationElement = e(AnnotationCount,props);
                ReactDOM.render(annotationElement, document.getElementById(elementID));
            }
            /*]]>*/
        }
        
        function checkInputAndOptionallyDisableSubmitButton(buttonID){
        	// disable button if the minimum number of components was not activated or question was not given
        	if(!checkComponentList("#sortable",minimumNumberOfSelectedComponents)){
        		$("#submit").attr("disabled", true);
        	} else if(!checkQuestionUriInput($("#question"))){
        		$("#submit").attr("disabled", true);
        	} else {
        		// everything ok
        		$("#submit").attr("disabled", false);
        	}
        }
        
        function checkQuestionUriInput(inputelement){
                if( $(inputelement).val().trim() == "" ){
                        $(inputelement).addClass("isempty");
                        return false;
                } else {
                        $(inputelement).removeClass("isempty");
                        return true;
                } 
        }
        
        function checkComponentList(blockElementContainingCheckboxes, minimumNumberOfSelectedComponents){
			if( $(blockElementContainingCheckboxes).find("input:checked").length >= minimumNumberOfSelectedComponents){
                $(blockElementContainingCheckboxes).removeClass("missingcomponentselection");
                return true;
			} else {
				$(blockElementContainingCheckboxes).addClass("missingcomponentselection");
				return false;
			}	
        }
        
		function filterComponentList() {
		  // Declare variables
		  var input, filter, ul, li, txtValue, hidden, speed;
		  speed = 333;
		  input = document.getElementById('componentfilterinput');
		   
		  filter = input.value.toUpperCase();
		  ul = document.getElementById("sortable");
		  li = ul.getElementsByTagName("li");

		  showEverything = false;
		  if( filter.trim().length == 0 ){
		  	showEverything = true;
		  }
		  
		  // Loop through all list items, and hide those who don't match the search query
		  hidden = 0;
		  for (i = 0; i < li.length; i++) {
		  	if( showEverything ){
		  		$(li[i]).fadeIn(speed);
		  	} else {
			    txtValue = li[i].innerText;
			    if (txtValue.toUpperCase().indexOf(filter) > -1) {
			      $(li[i]).fadeIn(speed);
			    } else {
			      $(li[i]).fadeOut(speed);
			      hidden++;
			    }
		    }
		  }

		  console.debug("filter", filter, "showEverything", showEverything, "li.length", li.length, "hidden", hidden);
		}   
    </script>
